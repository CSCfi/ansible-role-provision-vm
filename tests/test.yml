---

-   name: Playbook for CI testing.
    hosts: localhost
    remote_user: root
    vars:
      ansible_python_interpreter: /usr/libexec/platform-python

    pre_tasks:
      - name: Add target VMs dynamically based on the hypervisor OS
        ansible.builtin.add_host:
          name: "{{ item }}"
          groups: provision_vm
        loop: >- 
          {{ 
            groups['centos8'] if ansible_distribution_major_version == '8' 
            else (groups['centos8'] + groups['almalinux9']) 
          }}
        when: ansible_distribution_major_version == '8' or ansible_distribution_major_version == '9'

-   name: Playbook for CI testing.
    hosts: provision_vm
    serial: 1
    gather_facts: yes
    remote_user: root
    vars:
      hyper: "localhost"
      dns:
        - 8.8.8.8
        - 1.1.1.1
      network_mask: "255.255.255.0"
      network_prefix: "/24"
      network_gateway4: "192.168.1.1"
      internal_ip: "{{ network_address }}"
      ansible_python_interpreter: /usr/libexec/platform-python
    roles:
      - ansible-role-provision-vm
...
